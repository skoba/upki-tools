# Contributing to UPKI Certificate Management System

UPKI証明書管理システムへの貢献を歓迎します！このプロジェクトは大学関係者のPKI証明書管理を支援することを目的としています。

## 貢献方法

### 1. Issues（課題報告）

以下のような場合はIssueを作成してください：

- **バグ報告**: 予期しない動作や エラーの発見
- **機能要求**: 新しい機能や改善の提案
- **ドキュメント改善**: README、ドキュメントの不明瞭な部分
- **質問**: 使用方法や実装に関する質問

#### ⚠️ セキュリティ関連の重要な注意事項

**絶対に以下の情報を公開Issueに含めないでください：**

🔒 **機密情報（絶対禁止）:**
- **秘密鍵** (private key, .key ファイル)
- **証明書の秘密情報** (passphrase, パスワード)
- **実際の証明書ファイル** (.crt, .pem ファイル)
- **CSR（証明書署名要求）** の実データ
- **本番環境のドメイン名** や組織情報
- **データベースの内容** やダンプファイル
- **アクセストークン** やAPIキー

📋 **代替手段:**
- **ダミーデータ**: `example.com`, `test.medical-oss.org` 等を使用
- **サンプル証明書**: OpenSSLで生成したテスト用証明書
- **マスク処理**: 実際の値を `[REDACTED]` や `***` で置換
- **構造のみ**: 実際の値ではなく、データ構造やフィールド名のみ

#### 🛡️ ログ・エラーメッセージの注意点

ログファイルやエラーメッセージを貼り付ける前に：

1. **秘密鍵の内容**が含まれていないか確認
2. **証明書のシリアル番号**等の実データを除去
3. **ファイルパス**に個人情報が含まれていないか確認
4. **IPアドレス**や**内部ホスト名**をマスク

**例（良い例）:**
```
Error: Failed to load certificate
File: /app/tmp/[REDACTED].crt
Domain: example.com
Error: Invalid certificate format
```

**例（悪い例 - 絶対禁止）:**
```
Error: Failed to load certificate
-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC...
-----END PRIVATE KEY-----
```

#### 📝 推奨されるIssueテンプレート

```markdown
## 概要
問題や要求の簡潔な説明

## 環境
- OS: 
- Ruby版: 
- Rails版: 
- ブラウザ: 
- Docker使用: Yes/No

## 再現手順
1. 
2. 
3. 

⚠️ **注意**: 実際のドメイン名や証明書データは記載せず、
example.com等のダミーデータを使用してください

## 期待される動作

## 実際の動作

## エラーメッセージ（機密情報を除去済み）
```
エラーログをここに貼り付け
（秘密鍵、実際の証明書、パスワード等は必ず除去）
```

## スクリーンショット
必要に応じて添付（機密情報が写っていないことを確認）

## 追加情報
その他関連する情報
```

#### 🚨 万が一機密情報を投稿してしまった場合

1. **即座にIssueを閉じる**
2. **GitHub Supportに連絡**して完全削除を依頼
3. **関連する証明書の失効**を検討
4. **パスワードの変更**を実施
5. **skoba@moss.gr.jp**に緊急連絡

### 2. Pull Requests（プルリクエスト）

#### 事前準備

1. **リポジトリをフォーク**
   ```bash
   # GitHubでフォークボタンをクリック
   git clone https://github.com/YOUR_USERNAME/upki-tools.git
   cd upki-tools
   ```

2. **開発環境のセットアップ**
   ```bash
   # Dockerを使用（推奨）
   docker-compose up -d
   
   # またはローカル環境
   bundle install
   npm install
   bin/rails db:prepare
   ```

3. **ブランチの作成**
   ```bash
   git checkout -b feature/your-feature-name
   # または
   git checkout -b fix/issue-number
   ```

#### 開発ガイドライン

**コード品質:**
- RuboCopに準拠したコードスタイル
- テストカバレッジの維持・向上
- 適切なコメント（特にPKI関連の複雑な処理）

**テスト:**
```bash
# テスト実行
bin/rspec

# コード品質チェック
bundle exec rubocop

# 自動修正
bundle exec rubocop -a
```

**コミット:**
- 明確で説明的なコミットメッセージ
- 1つのコミットで1つの変更
- 日本語または英語（プロジェクトに合わせて）

**コミットメッセージ例:**
```
証明書生成時のパスフレーズ検証機能を追加

- OpenSSL::PKey::RSAでの暗号化処理を改善
- パスフレーズの強度チェックを実装
- 関連するテストケースを追加

Fixes #123
```

### 3. セキュリティに関する注意事項

**重要**: PKI証明書管理システムの性質上、セキュリティは最優先事項です。

#### セキュリティ関連の変更

以下の変更は特に注意深くレビューされます：
- 暗号化・復号化処理
- 秘密鍵の生成・保存
- 証明書の検証処理
- アクセス制御機能

#### 機密情報の取り扱い

- **絶対に実際の秘密鍵や証明書をコミットしない**
- テストデータは適切にサニタイズされたサンプルのみ使用
- 本番環境のデータベースダンプ等は含めない
- ログファイルに機密情報が含まれていないか確認

#### セキュリティ脆弱性の報告

セキュリティ脆弱性を発見した場合：
1. **公開Issueは作成しない**
2. **直接メール**で報告: skoba@moss.gr.jp
3. 詳細な情報と再現手順を含める
4. 修正まで情報の公開を控える

### 4. 開発の優先事項

#### 高優先度
- セキュリティ向上
- 既存機能のバグ修正
- テストカバレッジの向上
- ドキュメントの改善

#### 中優先度
- 新機能の追加
- パフォーマンス改善
- UI/UXの向上
- 国際化対応

#### 低優先度
- コードリファクタリング
- 追加的な開発ツール
- 実験的機能

### 5. コードレビュープロセス

#### レビュー観点
- **機能**: 仕様通りに動作するか
- **セキュリティ**: 脆弱性はないか
- **テスト**: 適切なテストが含まれているか
- **コード品質**: 読みやすく保守しやすいか
- **ドキュメント**: 必要に応じてドキュメントが更新されているか

#### レビュー参加者
- メンテナ: @skoba
- PKI専門家
- セキュリティ専門家
- 大学関係者

### 6. 特定領域への貢献

#### PKI・証明書専門知識が必要な領域
- OpenSSL関連の暗号化処理
- X.509証明書の検証・解析
- CSR生成アルゴリズム
- 証明書チェーン検証

#### Web開発知識で貢献可能な領域
- UI/UXの改善
- Rails 8の最新機能活用
- フロントエンド（Stimulus, Turbo）
- Docker環境の改善

#### ドキュメント・翻訳
- 英語ドキュメントの追加
- セットアップガイドの改善
- トラブルシューティング情報
- 多言語対応

### 7. リリースプロセス

#### バージョニング
- セマンティックバージョニング（SemVer）に従う
- セキュリティ修正: パッチ版（1.0.1）
- 新機能: マイナー版（1.1.0）
- 破壊的変更: メジャー版（2.0.0）

#### リリース前チェックリスト
- [ ] 全テストの成功
- [ ] セキュリティスキャン
- [ ] ドキュメント更新
- [ ] 変更履歴（CHANGELOG.md）更新
- [ ] Docker環境での動作確認

## 開発環境

### 推奨ツール
- **エディタ**: VS Code, RubyMine, Vim
- **Ruby管理**: rbenv
- **DB管理**: SQLite Browser
- **API テスト**: Postman, curl

### 有用なコマンド
```bash
# 開発サーバー起動（自動リロード付き）
guard start

# データベースリセット
bin/rails db:reset

# アセットプリコンパイル
bin/rails assets:precompile

# Docker環境リセット
docker-compose down -v && docker-compose up --build
```

## コミュニティ

### コミュニケーション
- **Issues**: 技術的な議論
- **Discussions**: アイデアや質問
- **Email**: skoba@moss.gr.jp（重要事項）

### 行動規範
- 建設的で尊重のあるコミュニケーション
- 多様な背景・経験レベルの参加者を歓迎
- セキュリティとプライバシーの重要性を理解
- 大学PKI環境の特殊性を考慮

## 謝辞

UPKI証明書管理システムの改善に貢献いただくすべての方々に感謝します。特に：

- 大学情報システム管理者の皆様
- PKI・セキュリティ専門家の皆様
- オープンソースコミュニティの皆様

あなたの貢献が、日本の大学PKIインフラストラクチャの向上に直接つながります。

---

## 免責事項

### 貢献者の責任について

このプロジェクトに貢献する際は、以下の点をご理解ください：

#### セキュリティに関する責任
- **提案する機能やコード**がセキュリティ上の脆弱性を生まない責任
- **テストデータ**に実際の機密情報を含めない責任
- **セキュリティベストプラクティス**に従う責任

#### 品質と動作保証
- **貢献したコード**について動作保証は行いません
- **他の環境での動作**は保証されません
- **データ損失や障害**について貢献者は責任を負いません

#### 法的遵守
- **著作権侵害**のないオリジナルコードの提供
- **ライセンス互換性**の確認
- **輸出管理法規**等の遵守（暗号化技術を含むため）

#### 医療・教育機関での利用
- **各機関の情報セキュリティポリシー**への準拠確認
- **個人情報保護法**等の関連法令の遵守
- **適切な運用体制**での利用推奨

### 貢献の取り扱い

- すべての貢献は**コミュニティの共有財産**となります
- **商用利用**される可能性があります
- **改変・再配布**される可能性があります

**重要**: 本プロジェクトは教育・研究目的での利用を主眼としていますが、PKI証明書管理という性質上、適切でない使用は重大なセキュリティリスクを生む可能性があります。

## ライセンス

このプロジェクトへの貢献は、MITライセンスの下で公開されます。詳細は[LICENSE](LICENSE)を参照してください。